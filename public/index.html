<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vKomari</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [x-cloak] {
            display: none !important;
        }

        .toggle-bg:after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: 0.2s;
        }

        input:checked+.toggle-bg:after {
            transform: translateX(100%);
        }

        input:checked+.toggle-bg {
            background-color: #10b981;
        }

        /* ÊªöÂä®Êù°ÁæéÂåñ */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #27272a;
        }

        ::-webkit-scrollbar-thumb {
            background: #52525b;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #71717a;
        }
    </style>
</head>

<body class="bg-zinc-900 text-zinc-100 min-h-screen font-sans" x-data="app()" x-cloak>

    <!-- ÁôªÂΩïÈ°µ -->
    <div x-show="!token" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-sm">
            <h1 class="text-4xl font-bold text-emerald-400 text-center mb-2">vKomari</h1>
            <p class="text-zinc-500 text-center mb-6 text-sm">ËôöÊãüÊé¢ÈíàÈõÜÁæ§ÁÆ°ÁêÜÁ≥ªÁªü</p>
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-6 shadow-xl">
                <form @submit.prevent="login" class="space-y-4">
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1">Áî®Êà∑Âêç</label>
                        <input type="text" x-model="loginForm.username"
                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-4 py-3 focus:outline-none focus:border-emerald-500 transition">
                    </div>
                    <div>
                        <label class="block text-xs text-zinc-400 mb-1">ÂØÜÁ†Å</label>
                        <input type="password" x-model="loginForm.password"
                            class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-4 py-3 focus:outline-none focus:border-emerald-500 transition">
                    </div>
                    <div x-show="loginError" class="text-red-400 text-sm text-center bg-red-900/20 py-2 rounded"
                        x-text="loginError"></div>
                    <button type="submit"
                        class="w-full bg-emerald-600 hover:bg-emerald-500 text-white py-3 rounded-lg font-semibold transition shadow-lg shadow-emerald-900/20">Áôª
                        ÂΩï</button>
                </form>
            </div>
        </div>
    </div>

    <!-- ‰∏ªÁïåÈù¢ -->
    <div x-show="token" class="min-h-screen">
        <header class="bg-zinc-800/90 backdrop-blur border-b border-zinc-700 sticky top-0 z-30 px-4 py-3">
            <div class="max-w-7xl mx-auto flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <div
                        class="w-8 h-8 bg-emerald-500/20 rounded-lg flex items-center justify-center text-emerald-400 font-bold">
                        V</div>
                    <h1 class="text-xl font-bold text-zinc-100">vKomari</h1>
                </div>
                <div class="flex flex-wrap gap-2">
                    <button @click="batchAction('start')"
                        class="px-3 py-1.5 text-xs bg-emerald-600/20 text-emerald-400 hover:bg-emerald-600/30 rounded border border-emerald-600/20 transition">ÂÖ®ÈÉ®ÂêØÂä®</button>
                    <button @click="batchAction('stop')"
                        class="px-3 py-1.5 text-xs bg-red-600/20 text-red-400 hover:bg-red-600/30 rounded border border-red-600/20 transition">ÂÖ®ÈÉ®ÂÅúÊ≠¢</button>
                    <div class="w-px h-6 bg-zinc-700 mx-1"></div>
                    <button @click="showPwdModal=true"
                        class="px-3 py-1.5 text-xs bg-zinc-700 hover:bg-zinc-600 text-zinc-300 rounded transition">ÊîπÂØÜ</button>
                    <button @click="logout"
                        class="px-3 py-1.5 text-xs bg-zinc-700 hover:bg-zinc-600 text-zinc-300 rounded transition">ÈÄÄÂá∫</button>
                    <button @click="openModal()"
                        class="px-4 py-1.5 text-xs bg-emerald-600 hover:bg-emerald-500 text-white rounded font-medium shadow-lg shadow-emerald-900/20 transition flex items-center gap-1">
                        <span class="text-lg leading-none">+</span> Ê∑ªÂä†ËäÇÁÇπ
                    </button>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto p-4 sm:p-6">
            <!-- ÁªüËÆ°Âç°Áâá -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4">
                    <div class="text-zinc-500 text-xs uppercase tracking-wider">ÊÄªËäÇÁÇπ</div>
                    <div class="text-2xl font-bold mt-1" x-text="nodes.length">0</div>
                </div>
                <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4">
                    <div class="text-zinc-500 text-xs uppercase tracking-wider">Âú®Á∫øËøêË°å</div>
                    <div class="text-2xl font-bold text-emerald-400 mt-1" x-text="nodes.filter(n=>n.online).length">0
                    </div>
                </div>
                <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4">
                    <div class="text-zinc-500 text-xs uppercase tracking-wider">ÂêØÁî®Áä∂ÊÄÅ</div>
                    <div class="text-2xl font-bold text-blue-400 mt-1" x-text="nodes.filter(n=>n.enabled).length">0
                    </div>
                </div>
                <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4">
                    <div class="text-zinc-500 text-xs uppercase tracking-wider">È´òË¥üËΩΩ</div>
                    <div class="text-2xl font-bold text-amber-400 mt-1"
                        x-text="nodes.filter(n=>n.load_profile==='high').length">0</div>
                </div>
            </div>

            <!-- ËäÇÁÇπÂàóË°® -->
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                <template x-for="n in nodes" :key="n.id">
                    <div
                        class="bg-zinc-800 border border-zinc-700 rounded-xl overflow-hidden hover:border-zinc-600 transition group">
                        <div class="p-4 border-b border-zinc-700/50 flex justify-between items-center bg-zinc-800/50">
                            <div class="flex items-center gap-3 min-w-0">
                                <div class="relative">
                                    <div class="w-2.5 h-2.5 rounded-full"
                                        :class="n.online?'bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.6)]':'bg-zinc-600'">
                                    </div>
                                    <div x-show="n.online"
                                        class="absolute inset-0 w-2.5 h-2.5 rounded-full bg-emerald-400 animate-ping opacity-75">
                                    </div>
                                </div>
                                <div class="flex flex-col min-w-0">
                                    <div class="flex items-center gap-2">
                                        <span class="font-bold truncate text-zinc-200" x-text="n.name"></span>
                                        <span class="text-sm" x-text="getFlag(n.region)"></span>
                                    </div>
                                    <span class="text-xs text-zinc-500 truncate" x-text="n.server_address"></span>
                                </div>
                            </div>
                            <div class="flex items-center gap-3 shrink-0">
                                <span class="text-[10px] uppercase font-bold px-2 py-0.5 rounded border" :class="{
                                          'bg-emerald-500/10 text-emerald-400 border-emerald-500/20':n.load_profile==='low',
                                          'bg-amber-500/10 text-amber-400 border-amber-500/20':n.load_profile==='mid',
                                          'bg-red-500/10 text-red-400 border-red-500/20':n.load_profile==='high'
                                      }" x-text="n.load_profile"></span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" :checked="n.enabled"
                                        @change="toggleNode(n.id,$event.target.checked)">
                                    <div
                                        class="toggle-bg w-9 h-5 bg-zinc-700 peer-focus:outline-none rounded-full relative border border-zinc-600">
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div class="p-4 space-y-2 text-sm">
                            <div class="flex justify-between items-center"><span class="text-zinc-500">ÈÖçÁΩÆ</span><span
                                    class="text-zinc-300 font-mono" x-text="n.cpu_cores+'C / '+n.ram_total+'MB'"></span>
                            </div>
                            <div class="flex justify-between items-center"><span class="text-zinc-500">Á≥ªÁªü</span><span
                                    class="text-zinc-300 text-xs truncate max-w-[180px]" x-text="n.os"></span></div>
                            <div class="flex justify-between items-center"><span class="text-zinc-500">ÂÜÖÊ†∏</span><span
                                    class="text-zinc-300 text-xs truncate max-w-[180px]"
                                    x-text="n.kernel_version"></span></div>
                            <div class="flex justify-between items-center pt-1 border-t border-zinc-700/50"><span
                                    class="text-zinc-500">‰∏äÊä•ÁªüËÆ°</span><span class="text-emerald-400 font-mono"
                                    x-text="n.sendCount||0"></span></div>
                        </div>
                        <div class="px-4 py-3 border-t border-zinc-700/50 flex gap-2 bg-zinc-800/30">
                            <button @click="editNode(n)"
                                class="flex-1 bg-zinc-700 hover:bg-zinc-600 text-zinc-300 py-1.5 rounded-lg text-xs font-medium transition">ÈÖçÁΩÆ</button>
                            <button @click="deleteNode(n.id)"
                                class="flex-1 bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/10 py-1.5 rounded-lg text-xs font-medium transition">Âà†Èô§</button>
                        </div>
                    </div>
                </template>
            </div>
            <div x-show="nodes.length===0"
                class="text-center py-20 text-zinc-500 bg-zinc-800/30 rounded-xl border border-zinc-700/50 border-dashed">
                <p class="text-lg">ÊöÇÊó†ËäÇÁÇπ</p>
                <p class="text-sm mt-2">ÁÇπÂáªÂè≥‰∏äËßíÊ∑ªÂä†ÊåâÈíÆÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑËôöÊãüËäÇÁÇπ</p>
            </div>
        </main>
    </div>

    <!-- ÁºñËæëÂºπÁ™ó -->
    <div x-show="showModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50"
        style="display:none" x-transition.opacity>
        <div
            class="bg-zinc-800 border border-zinc-700 rounded-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl flex flex-col">
            <div class="p-5 border-b border-zinc-700 flex justify-between items-center sticky top-0 bg-zinc-800 z-10">
                <h2 class="text-lg font-bold text-zinc-100" x-text="form.id?'ÁºñËæëËäÇÁÇπÈÖçÁΩÆ':'Êñ∞Âª∫ËôöÊãüËäÇÁÇπ'"></h2>
                <button @click="showModal=false"
                    class="text-zinc-500 hover:text-zinc-300 transition p-1 hover:bg-zinc-700 rounded">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <div class="p-6 space-y-6">
                <!-- Âü∫Á°Ä‰ø°ÊÅØ -->
                <div class="space-y-4">
                    <h3 class="text-sm font-medium text-emerald-400 uppercase tracking-wider">Âü∫Á°Ä‰ø°ÊÅØ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs text-zinc-400 mb-1.5">ËäÇÁÇπÂêçÁß∞</label>
                            <input type="text" x-model="form.name"
                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition">
                        </div>
                        <div class="relative">
                            <label class="block text-xs text-zinc-400 mb-1.5">Âú∞Âå∫ (ÊêúÁ¥¢)</label>
                            <div class="relative">
                                <span class="absolute left-3 top-2 text-lg" x-text="getFlag(form.region)"></span>
                                <input type="text" x-model="countrySearch" @focus="showCountryList=true"
                                    @input="showCountryList=true" @blur="setTimeout(()=>showCountryList=false,150)"
                                    placeholder="ÊêúÁ¥¢ÂõΩÂÆ∂..."
                                    class="w-full bg-zinc-900 border border-zinc-700 rounded-lg pl-10 pr-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition">
                            </div>
                            <div x-show="showCountryList"
                                class="absolute z-20 w-full mt-1 bg-zinc-800 border border-zinc-700 rounded-lg max-h-60 overflow-y-auto shadow-xl">
                                <template x-for="c in filteredCountries" :key="c.code">
                                    <div @mousedown.prevent="form.region=c.code;countrySearch=c.name;showCountryList=false"
                                        class="px-3 py-2 hover:bg-zinc-700 cursor-pointer text-sm flex items-center gap-2 transition">
                                        <span class="text-lg" x-text="c.flag"></span>
                                        <span class="text-zinc-300" x-text="c.name"></span>
                                        <span class="text-zinc-500 text-xs ml-auto" x-text="c.code"></span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs text-zinc-400 mb-1.5">Êé¢ÈíàÂú∞ÂùÄ (WebSocket/HTTP)</label>
                            <input type="text" x-model="form.server_address" placeholder="‰æãÂ¶Ç: komari.example.com"
                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition font-mono">
                        </div>
                        <div>
                            <label class="block text-xs text-zinc-400 mb-1.5">ÂØÜÈí• (Secret)</label>
                            <input type="text" x-model="form.client_secret"
                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition font-mono">
                        </div>
                    </div>
                </div>

                <div class="w-full h-px bg-zinc-700/50"></div>

                <!-- Á≥ªÁªüÈÖçÁΩÆ -->
                <div class="space-y-4">
                    <h3 class="text-sm font-medium text-emerald-400 uppercase tracking-wider">Á≥ªÁªüÁéØÂ¢É</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs text-zinc-400 mb-1.5">Êìç‰ΩúÁ≥ªÁªü</label>
                            <select x-model="form.os" @change="onOsChange()"
                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition">
                                <option value="Debian GNU/Linux 12 (bookworm)">Debian 12</option>
                                <option value="Debian GNU/Linux 11 (bullseye)">Debian 11</option>
                                <option value="Ubuntu 24.04 LTS">Ubuntu 24.04 LTS</option>
                                <option value="Ubuntu 22.04 LTS">Ubuntu 22.04 LTS</option>
                                <option value="Ubuntu 20.04 LTS">Ubuntu 20.04 LTS</option>
                                <option value="CentOS Stream 9">CentOS Stream 9</option>
                                <option value="Rocky Linux 9">Rocky Linux 9</option>
                                <option value="AlmaLinux 9">AlmaLinux 9</option>
                                <option value="Fedora 40">Fedora 40</option>
                                <option value="Arch Linux">Arch Linux</option>
                                <option value="Alpine Linux 3.20">Alpine Linux 3.20</option>
                                <option value="openSUSE Leap 15.6">openSUSE Leap 15.6</option>
                                <option value="Windows Server 2022">Windows Server 2022</option>
                                <option value="Windows 11">Windows 11</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs text-zinc-400 mb-1.5">ÂÜÖÊ†∏ÁâàÊú¨</label>
                            <select x-model="form.kernel_version"
                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition font-mono">
                                <template x-for="k in getKernelsForOs(form.os)" :key="k">
                                    <option :value="k" x-text="k"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs text-zinc-400 mb-1.5">Êû∂ÊûÑ</label>
                            <select x-model="form.arch"
                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition">
                                <option value="amd64">amd64 (x86_64)</option>
                                <option value="aarch64">aarch64 (ARM64)</option>
                                <option value="i386">i386 (x86)</option>
                                <option value="armv7l">armv7l (ARM32)</option>
                                <option value="riscv64">riscv64</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs text-zinc-400 mb-1.5">ËôöÊãüÂåñÊäÄÊúØ</label>
                            <select x-model="form.virtualization"
                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition">
                                <option value="kvm">KVM</option>
                                <option value="vmware">VMware</option>
                                <option value="hyperv">Hyper-V</option>
                                <option value="xen">Xen</option>
                                <option value="lxc">LXC</option>
                                <option value="openvz">OpenVZ</option>
                                <option value="docker">Docker</option>
                                <option value="none">Áâ©ÁêÜÊú∫ (None)</option>
                            </select>
                        </div>
                        <div class="md:col-span-1">
                            <label class="block text-xs text-zinc-400 mb-1.5">CPU ÂûãÂè∑</label>
                            <select x-model="form.cpu_model"
                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition">
                                <option value="Intel(R) Xeon(R) CPU E5-2690 v4 @ 2.60GHz">Intel Xeon E5-2690 v4</option>
                                <option value="Intel(R) Xeon(R) Platinum 8259CL CPU @ 2.50GHz">Intel Xeon Platinum
                                    8259CL</option>
                                <option value="Intel(R) Xeon(R) Gold 6133 CPU @ 2.50GHz">Intel Xeon Gold 6133</option>
                                <option value="AMD EPYC 7763 64-Core Processor">AMD EPYC 7763</option>
                                <option value="AMD EPYC 7B12 64-Core Processor">AMD EPYC 7B12</option>
                                <option value="AMD Ryzen 9 5950X 16-Core Processor">AMD Ryzen 9 5950X</option>
                                <option value="Intel(R) Core(TM) i9-13900K">Intel Core i9-13900K</option>
                                <option value="Ampere Altra Q80-30">Ampere Altra Q80 (ARM)</option>
                                <option value="Apple M2 Pro">Apple M2 Pro</option>
                                <option value="QEMU Virtual CPU version 2.5+">QEMU Virtual CPU</option>
                                <option value="Common KVM processor">KVM Processor</option>
                            </select>
                        </div>
                        <div class="md:col-span-1">
                            <label class="block text-xs text-zinc-400 mb-1.5">ÂêØÂä®Êó∂Èó¥ (ÁïôÁ©∫‰∏∫ÂΩìÂâç)</label>
                            <input type="date" x-model="form.boot_time_date"
                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition text-zinc-300">
                        </div>
                    </div>
                </div>

                <div class="w-full h-px bg-zinc-700/50"></div>

                <!-- Á°¨‰ª∂ËßÑÊ†º -->
                <div class="space-y-4">
                    <h3 class="text-sm font-medium text-emerald-400 uppercase tracking-wider">Á°¨‰ª∂ËßÑÊ†º</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div><label class="block text-xs text-zinc-400 mb-1.5">CPU Ê†∏ÂøÉÊï∞</label><input type="number"
                                x-model.number="form.cpu_cores"
                                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition">
                        </div>

                        <div>
                            <label class="block text-xs text-zinc-400 mb-1.5">ÂÜÖÂ≠ò</label>
                            <div class="flex">
                                <input type="number" x-model.number="form.ram_total"
                                    class="w-full bg-zinc-900 border border-zinc-700 rounded-l-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition border-r-0">
                                <button @click="form.ram_unit = form.ram_unit === 'MB' ? 'GB' : 'MB'"
                                    class="bg-zinc-800 border-y border-r border-zinc-700 px-2 text-xs rounded-r-lg hover:bg-zinc-700 transition"
                                    x-text="form.ram_unit"></button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs text-zinc-400 mb-1.5">Swap</label>
                            <div class="flex">
                                <input type="number" x-model.number="form.swap_total"
                                    class="w-full bg-zinc-900 border border-zinc-700 rounded-l-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition border-r-0">
                                <button @click="form.swap_unit = form.swap_unit === 'MB' ? 'GB' : 'MB'"
                                    class="bg-zinc-800 border-y border-r border-zinc-700 px-2 text-xs rounded-r-lg hover:bg-zinc-700 transition"
                                    x-text="form.swap_unit"></button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs text-zinc-400 mb-1.5">Á°¨Áõò</label>
                            <div class="flex">
                                <input type="number" x-model.number="form.disk_total"
                                    class="w-full bg-zinc-900 border border-zinc-700 rounded-l-lg px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none transition border-r-0">
                                <button @click="form.disk_unit = form.disk_unit === 'MB' ? 'GB' : 'MB'"
                                    class="bg-zinc-800 border-y border-r border-zinc-700 px-2 text-xs rounded-r-lg hover:bg-zinc-700 transition"
                                    x-text="form.disk_unit"></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="w-full h-px bg-zinc-700/50"></div>

                <!-- Ë¥üËΩΩÊ®°Êãü -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-medium text-emerald-400 uppercase tracking-wider">Ë¥üËΩΩÊ®°ÊãüÈÖçÁΩÆ</h3>
                        <div class="flex gap-2">
                            <label class="text-xs text-zinc-400 self-center">Âø´ÈÄüÈ¢ÑËÆæ:</label>
                            <select x-model="form.load_profile" @change="applyPreset"
                                class="bg-zinc-900 border border-zinc-700 rounded px-2 py-1 text-xs focus:border-emerald-500 focus:outline-none transition">
                                <option value="low">üü¢ ‰ΩéË¥üËΩΩ (Èó≤ÁΩÆ)</option>
                                <option value="mid">üü° ‰∏≠Ë¥üËΩΩ (Ê≠£Â∏∏)</option>
                                <option value="high">üî¥ È´òË¥üËΩΩ (ÁπÅÂøô)</option>
                            </select>
                        </div>
                    </div>

                    <div class="bg-zinc-900/50 border border-zinc-700/50 rounded-xl p-4 space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                            <!-- CPU -->
                            <div class="space-y-1">
                                <div class="flex justify-between"><label class="text-xs text-zinc-400">CPU ‰ΩøÁî®Áéá
                                        (%)</label><span class="text-xs text-zinc-500">Min - Max</span></div>
                                <div class="flex gap-2 items-center">
                                    <input type="number" x-model.number="form.cpu_min"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                    <span class="text-zinc-600">-</span>
                                    <input type="number" x-model.number="form.cpu_max"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                </div>
                            </div>
                            <!-- ÂÜÖÂ≠ò -->
                            <div class="space-y-1">
                                <div class="flex justify-between"><label class="text-xs text-zinc-400">ÂÜÖÂ≠ò ‰ΩøÁî®Áéá
                                        (%)</label><span class="text-xs text-zinc-500">Min - Max</span></div>
                                <div class="flex gap-2 items-center">
                                    <input type="number" x-model.number="form.mem_min"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                    <span class="text-zinc-600">-</span>
                                    <input type="number" x-model.number="form.mem_max"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                </div>
                            </div>
                            <!-- Swap -->
                            <div class="space-y-1">
                                <div class="flex justify-between"><label class="text-xs text-zinc-400">Swap ‰ΩøÁî®Áéá
                                        (%)</label><span class="text-xs text-zinc-500">Min - Max</span></div>
                                <div class="flex gap-2 items-center">
                                    <input type="number" x-model.number="form.swap_min"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                    <span class="text-zinc-600">-</span>
                                    <input type="number" x-model.number="form.swap_max"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                </div>
                            </div>
                            <!-- Á°¨Áõò -->
                            <div class="space-y-1">
                                <div class="flex justify-between"><label class="text-xs text-zinc-400">Á°¨Áõò ‰ΩøÁî®Áéá
                                        (%)</label><span class="text-xs text-zinc-500">Min - Max</span></div>
                                <div class="flex gap-2 items-center">
                                    <input type="number" x-model.number="form.disk_min"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                    <span class="text-zinc-600">-</span>
                                    <input type="number" x-model.number="form.disk_max"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                </div>
                            </div>
                            <!-- ÁΩëÈÄü -->
                            <div class="space-y-1">
                                <div class="flex justify-between items-center">
                                    <label class="text-xs text-zinc-400">ÂÆûÊó∂ÁΩëÈÄü</label>
                                    <div class="flex items-center gap-2">
                                        <button @click="toggleNetUnit()"
                                            class="text-[10px] bg-zinc-800 border border-zinc-700 px-1.5 py-0.5 rounded text-zinc-400 hover:text-white transition"
                                            x-text="form.net_unit"></button>
                                        <span class="text-xs text-zinc-500">Min - Max</span>
                                    </div>
                                </div>
                                <div class="flex gap-2 items-center">
                                    <input type="number" x-model.number="form.net_min"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                    <span class="text-zinc-600">-</span>
                                    <input type="number" x-model.number="form.net_max"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                </div>
                            </div>
                            <!-- ‰∏äÊä•Èó¥Èöî -->
                            <div class="space-y-1">
                                <label class="block text-xs text-zinc-400 mb-1.5">‰∏äÊä•Èó¥Èöî (Áßí)</label>
                                <input type="number" x-model.number="form.report_interval" min="1" max="60"
                                    class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                            </div>
                            <!-- ËøûÊé•Êï∞ -->
                            <div class="space-y-1">
                                <div class="flex justify-between"><label class="text-xs text-zinc-400">TCP
                                        ËøûÊé•Êï∞</label><span class="text-xs text-zinc-500">Min - Max</span></div>
                                <div class="flex gap-2 items-center">
                                    <input type="number" x-model.number="form.conn_min"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                    <span class="text-zinc-600">-</span>
                                    <input type="number" x-model.number="form.conn_max"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                </div>
                            </div>
                            <!-- ËøõÁ®ãÊï∞ -->
                            <div class="space-y-1">
                                <div class="flex justify-between"><label class="text-xs text-zinc-400">ËøõÁ®ãÊï∞Èáè</label><span
                                        class="text-xs text-zinc-500">Min - Max</span></div>
                                <div class="flex gap-2 items-center">
                                    <input type="number" x-model.number="form.proc_min"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                    <span class="text-zinc-600">-</span>
                                    <input type="number" x-model.number="form.proc_max"
                                        class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1.5 text-sm text-center">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div
                class="p-5 border-t border-zinc-700 flex justify-end gap-3 sticky bottom-0 bg-zinc-800 z-10 rounded-b-xl">
                <button @click="showModal=false"
                    class="px-5 py-2.5 text-zinc-400 hover:text-zinc-200 transition">ÂèñÊ∂à</button>
                <button @click="saveNode"
                    class="px-6 py-2.5 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg font-medium shadow-lg shadow-emerald-900/20 transition">‰øùÂ≠òÈÖçÁΩÆ</button>
            </div>
        </div>
    </div>

    <!-- ÊîπÂØÜÂºπÁ™ó -->
    <div x-show="showPwdModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50"
        style="display:none" x-transition.opacity>
        <div class="bg-zinc-800 border border-zinc-700 rounded-xl w-full max-w-sm p-6 shadow-2xl">
            <h2 class="text-lg font-bold text-amber-400 mb-4">‰øÆÊîπÁÆ°ÁêÜÂëòÂØÜÁ†Å</h2>
            <div class="space-y-4">
                <input type="password" x-model="newPassword" @keyup.enter="changePassword" placeholder="ËæìÂÖ•Êñ∞ÂØÜÁ†Å (Ëá≥Â∞ë6‰Ωç)"
                    class="w-full bg-zinc-900 border border-zinc-700 rounded-lg px-4 py-3 focus:border-amber-500 focus:outline-none transition">
                <div class="flex gap-3 pt-2">
                    <button x-show="!isDefaultPwd" @click="showPwdModal=false"
                        class="flex-1 text-zinc-500 hover:text-zinc-300 transition">ÂèñÊ∂à</button>
                    <button @click="changePassword"
                        class="flex-1 bg-amber-600 hover:bg-amber-500 text-white py-2.5 rounded-lg font-semibold transition shadow-lg shadow-amber-900/20">Á°ÆËÆ§‰øÆÊîπ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // OSÂà∞ÂÜÖÊ†∏ÁâàÊú¨Êò†Â∞Ñ
        const KERNEL_MAP = {
            'Debian GNU/Linux 12 (bookworm)': ['6.1.0-18-amd64', '6.1.0-25-amd64', '6.1.0-28-amd64'],
            'Debian GNU/Linux 11 (bullseye)': ['5.10.0-28-amd64', '5.10.0-30-amd64'],
            'Ubuntu 24.04 LTS': ['6.8.0-31-generic', '6.8.0-40-generic', '6.8.0-45-generic'],
            'Ubuntu 22.04 LTS': ['6.5.0-44-generic', '5.15.0-91-generic', '5.15.0-100-generic'],
            'Ubuntu 20.04 LTS': ['5.15.0-91-generic', '5.4.0-150-generic', '5.4.0-170-generic'],
            'CentOS Stream 9': ['5.14.0-362.8.1.el9_3', '5.14.0-427.el9', '5.14.0-503.el9'],
            'Rocky Linux 9': ['5.14.0-362.8.1.el9_3', '5.14.0-427.el9'],
            'AlmaLinux 9': ['5.14.0-362.8.1.el9_3', '5.14.0-427.el9'],
            'Fedora 40': ['6.8.5-301.fc40', '6.9.4-200.fc40'],
            'Arch Linux': ['6.6.30-2-lts', '6.7.9-arch1-1', '6.8.1-arch1-1'],
            'Alpine Linux 3.20': ['6.6.32-0-lts', '6.6.35-0-lts'],
            'openSUSE Leap 15.6': ['5.14.21-150500.55.73', '6.4.0-150600.21'],
            'Windows Server 2022': ['10.0.20348', '10.0.25398'],
            'Windows 11': ['10.0.22621', '10.0.22631', '10.0.26100']
        };

        // ÂÆåÊï¥ÂõΩÂÆ∂‰ª£Á†ÅÂàóË°®
        const COUNTRIES = [
            { code: 'CN', name: '‰∏≠ÂõΩ', flag: 'üá®üá≥' }, { code: 'HK', name: 'È¶ôÊ∏Ø', flag: 'üá≠üá∞' }, { code: 'TW', name: 'Âè∞Êπæ', flag: 'üáπüáº' }, { code: 'MO', name: 'Êæ≥Èó®', flag: 'üá≤üá¥' },
            { code: 'US', name: 'ÁæéÂõΩ', flag: 'üá∫üá∏' }, { code: 'JP', name: 'Êó•Êú¨', flag: 'üáØüáµ' }, { code: 'KR', name: 'Èü©ÂõΩ', flag: 'üá∞üá∑' }, { code: 'SG', name: 'Êñ∞Âä†Âù°', flag: 'üá∏üá¨' },
            { code: 'GB', name: 'Ëã±ÂõΩ', flag: 'üá¨üáß' }, { code: 'DE', name: 'Âæ∑ÂõΩ', flag: 'üá©üá™' }, { code: 'FR', name: 'Ê≥ïÂõΩ', flag: 'üá´üá∑' }, { code: 'NL', name: 'Ëç∑ÂÖ∞', flag: 'üá≥üá±' },
            { code: 'RU', name: '‰øÑÁΩóÊñØ', flag: 'üá∑üá∫' }, { code: 'CA', name: 'Âä†ÊãøÂ§ß', flag: 'üá®üá¶' }, { code: 'AU', name: 'Êæ≥Â§ßÂà©‰∫ö', flag: 'üá¶üá∫' }, { code: 'IN', name: 'Âç∞Â∫¶', flag: 'üáÆüá≥' },
            { code: 'TH', name: 'Ê≥∞ÂõΩ', flag: 'üáπüá≠' }, { code: 'VN', name: 'Ë∂äÂçó', flag: 'üáªüá≥' }, { code: 'MY', name: 'È©¨Êù•Ë•ø‰∫ö', flag: 'üá≤üáæ' }, { code: 'ID', name: 'Âç∞Â∞º', flag: 'üáÆüá©' },
            { code: 'PH', name: 'Ëè≤ÂæãÂÆæ', flag: 'üáµüá≠' }, { code: 'BR', name: 'Â∑¥Ë•ø', flag: 'üáßüá∑' }, { code: 'AR', name: 'ÈòøÊ†πÂª∑', flag: 'üá¶üá∑' }, { code: 'MX', name: 'Â¢®Ë•øÂì•', flag: 'üá≤üáΩ' },
            { code: 'ZA', name: 'ÂçóÈùû', flag: 'üáøüá¶' }, { code: 'EG', name: 'ÂüÉÂèä', flag: 'üá™üá¨' }, { code: 'TR', name: 'ÂúüËÄ≥ÂÖ∂', flag: 'üáπüá∑' }, { code: 'SA', name: 'Ê≤ôÁâπ', flag: 'üá∏üá¶' },
            { code: 'AE', name: 'ÈòøËÅîÈÖã', flag: 'üá¶üá™' }, { code: 'IL', name: '‰ª•Ëâ≤Âàó', flag: 'üáÆüá±' }, { code: 'IT', name: 'ÊÑèÂ§ßÂà©', flag: 'üáÆüáπ' }, { code: 'ES', name: 'Ë•øÁè≠Áâô', flag: 'üá™üá∏' },
            { code: 'PT', name: 'Ëë°ËêÑÁâô', flag: 'üáµüáπ' }, { code: 'PL', name: 'Ê≥¢ÂÖ∞', flag: 'üáµüá±' }, { code: 'SE', name: 'ÁëûÂÖ∏', flag: 'üá∏üá™' }, { code: 'NO', name: 'Êå™Â®Å', flag: 'üá≥üá¥' },
            { code: 'FI', name: 'Ëä¨ÂÖ∞', flag: 'üá´üáÆ' }, { code: 'DK', name: '‰∏πÈ∫¶', flag: 'üá©üá∞' }, { code: 'CH', name: 'ÁëûÂ£´', flag: 'üá®üá≠' }, { code: 'AT', name: 'Â••Âú∞Âà©', flag: 'üá¶üáπ' },
            { code: 'BE', name: 'ÊØîÂà©Êó∂', flag: 'üáßüá™' }, { code: 'IE', name: 'Áà±Â∞îÂÖ∞', flag: 'üáÆüá™' }, { code: 'CZ', name: 'Êç∑ÂÖã', flag: 'üá®üáø' }, { code: 'RO', name: 'ÁΩóÈ©¨Â∞º‰∫ö', flag: 'üá∑üá¥' },
            { code: 'HU', name: 'ÂåàÁâôÂà©', flag: 'üá≠üá∫' }, { code: 'GR', name: 'Â∏åËÖä', flag: 'üá¨üá∑' }, { code: 'UA', name: '‰πåÂÖãÂÖ∞', flag: 'üá∫üá¶' }, { code: 'KZ', name: 'ÂìàËê®ÂÖãÊñØÂù¶', flag: 'üá∞üáø' },
            { code: 'NZ', name: 'Êñ∞Ë•øÂÖ∞', flag: 'üá≥üáø' }, { code: 'CL', name: 'Êô∫Âà©', flag: 'üá®üá±' }, { code: 'CO', name: 'Âì•‰º¶ÊØî‰∫ö', flag: 'üá®üá¥' }, { code: 'PE', name: 'Âì•‰º¶ÊØî‰∫ö', flag: 'üáµüá™' },
            { code: 'PK', name: 'Â∑¥Âü∫ÊñØÂù¶', flag: 'üáµüá∞' }, { code: 'BD', name: 'Â≠üÂä†Êãâ', flag: 'üáßüá©' }, { code: 'NG', name: 'Â∞ºÊó•Âà©‰∫ö', flag: 'üá≥üá¨' }, { code: 'KE', name: 'ËÇØÂ∞º‰∫ö', flag: 'üá∞üá™' }
        ].sort((a, b) => a.code.localeCompare(b.code));

        function app() {
            return {
                token: localStorage.getItem('vkomari_token') || '',
                loginForm: { username: 'admin', password: '' },
                loginError: '',
                nodes: [],
                showModal: false,
                showPwdModal: false,
                isDefaultPwd: false,
                newPassword: '',
                form: {},
                presets: {},
                countrySearch: '',
                showCountryList: false,

                get filteredCountries() {
                    const s = this.countrySearch.toLowerCase();
                    return COUNTRIES.filter(c => c.code.toLowerCase().includes(s) || c.name.toLowerCase().includes(s));
                },

                getFlag(code) {
                    const c = COUNTRIES.find(x => x.code === code);
                    return c ? c.flag : 'üè≥Ô∏è';
                },

                getKernelsForOs(os) {
                    return KERNEL_MAP[os] || ['6.1.0-18-amd64'];
                },

                onOsChange() {
                    const kernels = this.getKernelsForOs(this.form.os);
                    if (kernels.length > 0 && !kernels.includes(this.form.kernel_version)) {
                        this.form.kernel_version = kernels[0];
                    }
                },

                init() {
                    if (this.token) {
                        // È™åËØÅ Token ÊúâÊïàÊÄß
                        fetch('/api/nodes', { headers: { 'Authorization': 'Bearer ' + this.token } })
                            .then(r => {
                                if (r.status === 401 || r.status === 403) this.logout();
                                else {
                                    r.json().then(d => this.nodes = d);
                                    this.start();
                                }
                            })
                            .catch(() => this.logout());
                    }
                    fetch('/api/presets').then(r => r.json()).then(d => this.presets = d).catch(() => { });
                },

                async login() {
                    try {
                        const r = await fetch('/api/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(this.loginForm) });
                        const d = await r.json();
                        if (r.ok) {
                            this.token = d.token;
                            localStorage.setItem('vkomari_token', d.token);
                            this.loginError = '';
                            if (d.isDefault) { this.isDefaultPwd = true; this.showPwdModal = true; }
                            this.start();
                        } else this.loginError = d.error;
                    } catch (e) { this.loginError = 'ËøûÊé•Â§±Ë¥•'; }
                },

                logout() { this.token = ''; localStorage.removeItem('vkomari_token'); this.nodes = []; },

                async changePassword() {
                    if (this.newPassword.length < 6) return alert('ÂØÜÁ†ÅËá≥Â∞ë6‰Ωç');
                    const r = await this.api('/api/change-password', 'POST', { newPassword: this.newPassword });
                    if (r && r.success) { alert('‰øÆÊîπÊàêÂäü'); this.showPwdModal = false; }
                },

                async api(url, method = 'GET', body = null) {
                    const opts = { method, headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + this.token } };
                    if (body) opts.body = JSON.stringify(body);
                    try {
                        const r = await fetch(url, opts);
                        if (r.status === 401 || r.status === 403) { this.logout(); return null; }
                        return await r.json();
                    } catch (e) { return null; }
                },

                start() { this.loadNodes(); setInterval(() => this.loadNodes(), 3000); },

                async loadNodes() { if (this.token) { const d = await this.api('/api/nodes'); if (d) this.nodes = d; } },

                openModal() {
                    const p = this.presets.low || {};
                    this.form = {
                        name: 'Node-' + (this.nodes.length + 1), server_address: '', client_secret: '',
                        cpu_model: 'Intel Xeon E5-2690 v4', cpu_cores: 2, ram_total: 2048, swap_total: 512, disk_total: 20480,
                        os: 'Debian GNU/Linux 12 (bookworm)', arch: 'amd64', virtualization: 'kvm', region: 'CN',
                        kernel_version: '6.1.0-18-amd64', load_profile: 'low', report_interval: 1, enabled: 1,
                        // Âçï‰ΩçÊéßÂà∂
                        ram_unit: 'MB', swap_unit: 'MB', disk_unit: 'MB', net_unit: 'Bytes',
                        // ÂêØÂä®Êó∂Èó¥
                        boot_time: 0, boot_time_date: '',
                        // Â°´ÂÖÖÈ¢ÑËÆæÂÄº
                        cpu_min: p.cpu_min, cpu_max: p.cpu_max, mem_min: p.mem_min, mem_max: p.mem_max,
                        swap_min: p.swap_min, swap_max: p.swap_max, disk_min: p.disk_min, disk_max: p.disk_max,
                        net_min: p.net_min, net_max: p.net_max, conn_min: p.conn_min, conn_max: p.conn_max,
                        proc_min: p.proc_min, proc_max: p.proc_max
                    };
                    this.countrySearch = '‰∏≠ÂõΩ';
                    this.showModal = true;
                },

                editNode(n) {
                    this.form = { ...n };
                    // ÂàùÂßãÂåñÁ°¨‰ª∂Âçï‰Ωç
                    this.form.ram_unit = 'MB'; this.form.swap_unit = 'MB'; this.form.disk_unit = 'MB';
                    if (this.form.ram_total >= 1024 && this.form.ram_total % 1024 === 0) { this.form.ram_total /= 1024; this.form.ram_unit = 'GB'; }
                    if (this.form.swap_total >= 1024 && this.form.swap_total % 1024 === 0) { this.form.swap_total /= 1024; this.form.swap_unit = 'GB'; }
                    if (this.form.disk_total >= 1024 && this.form.disk_total % 1024 === 0) { this.form.disk_total /= 1024; this.form.disk_unit = 'GB'; }

                    // ÂàùÂßãÂåñÁΩëÈÄüÂçï‰Ωç
                    this.form.net_unit = 'Bytes';
                    if (this.form.net_min >= 1048576) {
                        this.form.net_min /= 1048576; this.form.net_max /= 1048576; this.form.net_unit = 'MB';
                    } else if (this.form.net_min >= 1024) {
                        this.form.net_min /= 1024; this.form.net_max /= 1024; this.form.net_unit = 'KB';
                    }

                    // ÂàùÂßãÂåñÊó•Êúü
                    if (n.boot_time > 0) {
                        const date = new Date(n.boot_time * 1000);
                        this.form.boot_time_date = date.toISOString().slice(0, 10);
                    } else {
                        this.form.boot_time_date = '';
                    }

                    const c = COUNTRIES.find(x => x.code === n.region);
                    this.countrySearch = c ? c.name : n.region;
                    this.showModal = true;
                },

                applyPreset() {
                    const p = this.presets[this.form.load_profile];
                    if (p) {
                        const keys = ['cpu_min', 'cpu_max', 'mem_min', 'mem_max', 'swap_min', 'swap_max', 'disk_min', 'disk_max', 'conn_min', 'conn_max', 'proc_min', 'proc_max'];
                        keys.forEach(k => this.form[k] = p[k]);

                        // ÁΩëÈÄüÂçïÁã¨Â§ÑÁêÜ
                        let min = p.net_min, max = p.net_max;
                        if (this.form.net_unit === 'KB') { min /= 1024; max /= 1024; }
                        else if (this.form.net_unit === 'MB') { min /= 1048576; max /= 1048576; }
                        this.form.net_min = min; this.form.net_max = max;
                    }
                },

                toggleNetUnit() {
                    const u = this.form.net_unit;
                    let next = u === 'Bytes' ? 'KB' : (u === 'KB' ? 'MB' : 'Bytes');

                    // ËΩ¨Êç¢Êï∞ÂÄº
                    if (u === 'Bytes' && next === 'KB') { this.form.net_min /= 1024; this.form.net_max /= 1024; }
                    else if (u === 'KB' && next === 'MB') { this.form.net_min /= 1024; this.form.net_max /= 1024; }
                    else if (u === 'MB' && next === 'Bytes') { this.form.net_min *= 1048576; this.form.net_max *= 1048576; }
                    else if (u === 'KB' && next === 'Bytes') { this.form.net_min *= 1024; this.form.net_max *= 1024; }

                    this.form.net_unit = next;
                },

                async saveNode() {
                    if (!this.form.name || !this.form.server_address) return alert('ËØ∑Â°´ÂÜôÂêçÁß∞ÂíåÂú∞ÂùÄ');
                    this.form.server_address = this.form.server_address.replace(/\/+$/, ''); // ÂéªÈô§Â∞æÈÉ®ÊñúÊù†

                    // ÂÖãÈöÜË°®ÂçïÂØπË±°‰ª•ÈÅøÂÖç‰øÆÊîπÊòæÁ§∫ÂÄº
                    let payload = { ...this.form };

                    // Âçï‰ΩçËΩ¨Êç¢Âõû MB
                    if (this.form.ram_unit === 'GB') payload.ram_total *= 1024;
                    if (this.form.swap_unit === 'GB') payload.swap_total *= 1024;
                    if (this.form.disk_unit === 'GB') payload.disk_total *= 1024;

                    // ÁΩëÈÄüÂçï‰ΩçËΩ¨Êç¢Âõû Bytes
                    if (this.form.net_unit === 'KB') { payload.net_min *= 1024; payload.net_max *= 1024; }
                    else if (this.form.net_unit === 'MB') { payload.net_min *= 1048576; payload.net_max *= 1048576; }

                    // Â§ÑÁêÜÂêØÂä®Êó∂Èó¥Êó•Êúü
                    if (this.form.boot_time_date) {
                        payload.boot_time = Math.floor(new Date(this.form.boot_time_date).getTime() / 1000);
                    }

                    await this.api('/api/nodes', 'POST', payload);
                    this.showModal = false;
                    this.loadNodes();
                },

                async toggleNode(id, enabled) { await this.api('/api/toggle', 'POST', { id, enabled }); this.loadNodes(); },

                async batchAction(action) {
                    if (!confirm(action === 'start' ? 'ÂêØÂä®ÂÖ®ÈÉ®?' : 'ÂÅúÊ≠¢ÂÖ®ÈÉ®?')) return;
                    await this.api('/api/batch', 'POST', { action });
                    this.loadNodes();
                },

                async deleteNode(id) {
                    if (!confirm('Á°ÆÂÆöÂà†Èô§?')) return;
                    await this.api('/api/delete', 'POST', { id });
                    this.loadNodes();
                }
            }
        }
    </script>
</body>

</html>
